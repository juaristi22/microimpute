<!doctype html>
<html class="no-js" lang="en">
  <head><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Statistical Matching" href="../matching/index.html" /><link rel="prev" title="The Imputer class" href="index.html" />

    <!-- Generated with Sphinx 5.0.2 and Furo 2022.12.07 -->
        <title>Creating a new imputer model - MicroImpute documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?digest=91d0f0d1c444bdcb17a68e833c7a53903343c195" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="../../_static/style.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/style.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">MicroImpute documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../_static/logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">MicroImpute documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Models</span></p>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">The Imputer class</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Creating a new imputer model</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../matching/index.html">Statistical Matching</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../matching/matching-imputation.html">Statistical Matching imputation</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ols/index.html">Ordinary Least Squares Linear Regression</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ols/ols-imputation.html">Ordinary Least Squares (OLS) imputation</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../qrf/index.html">Quantile Regression Forests</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../qrf/qrf-imputation.html">Quantile Regression Forest (QRF) imputation</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../quantreg/index.html">Quantile Regression</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../quantreg/quantreg-imputation.html">Quantile Regression imputation</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Imputation and benchmarking</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../imputation-benchmarking/index.html">Benchmarking different imputation methods</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../imputation-benchmarking/benchmarking-methods.html">Benchmarking methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../imputation-benchmarking/imputing-across-surveys.html">Imputing across surveys</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AutoImpute</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../autoimpute/index.html">AutoImpute</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../autoimpute/autoimpute.html">AutoImputation</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SCF to CPS example</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../examples/scf_to_cps/index.html">Example: imputing wealth on the CPS data set</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../examples/scf_to_cps/imputing-from-scf-to-cps.html">Imputing wealth from the SCF to the CPS</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section class="tex2jax_ignore mathjax_ignore" id="creating-a-new-imputer-model">
<h1>Creating a new imputer model<a class="headerlink" href="#creating-a-new-imputer-model" title="Permalink to this heading">#</a></h1>
<p>This document demonstrates how to create a new imputation model by extending the <code class="docutils literal notranslate"><span class="pre">Imputer</span></code> and <code class="docutils literal notranslate"><span class="pre">ImputerResults</span></code> abstract base classes in MicroImpute.</p>
<section id="understanding-the-microimpute-architecture">
<h2>Understanding the microImpute architecture<a class="headerlink" href="#understanding-the-microimpute-architecture" title="Permalink to this heading">#</a></h2>
<p>MicroImpute uses a two-class architecture for imputation models:</p>
<ol class="arabic simple">
<li><p><strong>Imputer</strong>: The base model class that handles model initialization and fitting</p></li>
<li><p><strong>ImputerResults</strong>: Represents a fitted model and handles prediction</p></li>
</ol>
<p>This separation provides a clean distinction between the model definition and the fitted model instance, similar to statsmodels’ approach. Remember to check how currently supported models have been implemented if you would like to ensure full compatibility.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Any</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">validate_call</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">microimpute.models.imputer</span><span class="w"> </span><span class="kn">import</span> <span class="n">Imputer</span><span class="p">,</span> <span class="n">ImputerResults</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">microimpute.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">VALIDATE_CONFIG</span>
</pre></div>
</div>
</section>
<section id="implementing-a-model-results-class">
<h2>Implementing a model results class<a class="headerlink" href="#implementing-a-model-results-class" title="Permalink to this heading">#</a></h2>
<p>First, we need to implement the <code class="docutils literal notranslate"><span class="pre">ImputerResults</span></code> subclass that will represent our fitted model and handle predictions. Let’s create a model-specific imputer results class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">NewModelResults</span><span class="p">(</span><span class="n">ImputerResults</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fitted Model imputer ready for prediction.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">predictors</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">imputed_variables</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the NewModelResults parameter.</span>

<span class="sd">        Args:</span>
<span class="sd">            predictors: List of predictor variable names</span>
<span class="sd">            imputed_variables: List of imputed variable names</span>
<span class="sd">            **kwargs: Additional keyword arguments for model parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">predictors</span><span class="p">,</span> <span class="n">imputed_variables</span><span class="p">)</span>
        <span class="c1"># Add any additional model specific parameters here</span>

    <span class="c1"># You may choose to validate your model parameters with pydantic</span>
    <span class="nd">@validate_call</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">VALIDATE_CONFIG</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_predict</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">X_test</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">quantiles</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Predict imputed values at specified quantiles.</span>

<span class="sd">        Args:</span>
<span class="sd">            X_test: DataFrame containing the test data</span>
<span class="sd">            quantiles: List of quantiles to predict. If None, predicts at median</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary mapping quantiles to DataFrames with predicted values</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If prediction fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Implement model specific prediction functionality...</span>

            <span class="k">return</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during Model prediction: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to predict with Model: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</pre></div>
</div>
</section>
<section id="implementing-the-main-model-class">
<h2>Implementing the main model class<a class="headerlink" href="#implementing-the-main-model-class" title="Permalink to this heading">#</a></h2>
<p>Next, let’s implement the main <code class="docutils literal notranslate"><span class="pre">Imputer</span></code> subclass that will handle model initialization and fitting:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">NewModel</span><span class="p">(</span><span class="n">Imputer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Imputation model to be fitted.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the model parameters.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="nd">@validate_call</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">VALIDATE_CONFIG</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_fit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">X_train</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">predictors</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">imputed_variables</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NewModelResults</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit the Model on training data.</span>

<span class="sd">        Args:</span>
<span class="sd">            X_train: DataFrame containing training data</span>
<span class="sd">            predictors: List of predictor variable names</span>
<span class="sd">            imputed_variables: List of variable names to impute</span>
<span class="sd">            **kwargs: Additional arguments passed specific to Model</span>

<span class="sd">        Returns:</span>
<span class="sd">            NewModelResults instance with the fitted model</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If model fitting fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Implement model specific training functionality...</span>

            <span class="c1"># Return the results object with fitted models</span>
            <span class="k">return</span> <span class="n">NewModelResults</span><span class="p">(</span>
                <span class="n">predictors</span><span class="o">=</span><span class="n">predictors</span><span class="p">,</span>
                <span class="n">imputed_variables</span><span class="o">=</span><span class="n">imputed_variables</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>  <span class="c1"># Pass any additional model parameters here</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error fitting Model: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fit Model: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</pre></div>
</div>
</section>
<section id="testing-the-new-model">
<h2>Testing the new model<a class="headerlink" href="#testing-the-new-model" title="Permalink to this heading">#</a></h2>
<p>You can test the functionality of your newly implemented <code class="docutils literal notranslate"><span class="pre">NewModel</span></code> imputer model with a simple example using the Diabetes dataset:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.datasets</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_diabetes</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">microimpute.comparisons.data</span><span class="w"> </span><span class="kn">import</span> <span class="n">preprocess_data</span>

<span class="c1"># Load the Diabetes dataset</span>
<span class="n">diabetes</span> <span class="o">=</span> <span class="n">load_diabetes</span><span class="p">()</span>
<span class="n">diabetes_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">diabetes</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">diabetes</span><span class="o">.</span><span class="n">feature_names</span><span class="p">)</span>

<span class="c1"># Define predictors and variables to impute</span>
<span class="n">predictors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="s2">&quot;sex&quot;</span><span class="p">,</span> <span class="s2">&quot;bmi&quot;</span><span class="p">,</span> <span class="s2">&quot;bp&quot;</span><span class="p">]</span>
<span class="n">imputed_variables</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;s1&quot;</span><span class="p">,</span> <span class="s2">&quot;s4&quot;</span><span class="p">]</span>

<span class="c1"># Filter the data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">diabetes_df</span><span class="p">[</span><span class="n">predictors</span> <span class="o">+</span> <span class="n">imputed_variables</span><span class="p">]</span>

<span class="c1"># Split into train and test</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">dummy_info</span> <span class="o">=</span> <span class="n">preprocess_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># Initialize our new model</span>
<span class="n">new_imputer</span> <span class="o">=</span> <span class="n">NewModel</span><span class="p">()</span>

<span class="c1"># Fit the model</span>
<span class="n">fitted_model</span> <span class="o">=</span> <span class="n">new_imputer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">X_train</span><span class="p">,</span>
    <span class="n">predictors</span><span class="p">,</span>
    <span class="n">imputed_variables</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Make predictions at different quantiles</span>
<span class="n">test_quantiles</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">]</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">fitted_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">test_quantiles</span><span class="p">)</span>

<span class="c1"># Print sample predictions</span>
<span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">test_quantiles</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Predictions at </span><span class="si">{</span><span class="n">q</span><span class="si">}</span><span class="s2"> quantile:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">predictions</span><span class="p">[</span><span class="n">q</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</section>
<section id="integrating-with-the-benchmarking-framework">
<h2>Integrating with the benchmarking framework<a class="headerlink" href="#integrating-with-the-benchmarking-framework" title="Permalink to this heading">#</a></h2>
<p>The new <code class="docutils literal notranslate"><span class="pre">NewModel</span></code> model is then ready to be integrated into the MicroImpute benchmarking framework. Here’s how you would compare it with other models:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">microimpute.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">OLS</span><span class="p">,</span> <span class="n">QRF</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">microimpute.comparisons</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">get_imputations</span><span class="p">,</span>
    <span class="n">compare_quantile_loss</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">microimpute.visualizations.plotting</span><span class="w"> </span><span class="kn">import</span> <span class="n">method_comparison_results</span>

<span class="c1"># Define models to compare</span>
<span class="n">model_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">NewModel</span><span class="p">,</span> <span class="n">OLS</span><span class="p">,</span> <span class="n">QRF</span><span class="p">]</span>

<span class="c1"># Get test data for evaluation</span>
<span class="n">Y_test</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[</span><span class="n">imputed_variables</span><span class="p">]</span>

<span class="c1"># Get imputations from all models</span>
<span class="n">method_imputations</span> <span class="o">=</span> <span class="n">get_imputations</span><span class="p">(</span>
    <span class="n">model_classes</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">predictors</span><span class="p">,</span> <span class="n">imputed_variables</span>
<span class="p">)</span>

<span class="c1"># Compare quantile loss</span>
<span class="n">loss_comparison_df</span> <span class="o">=</span> <span class="n">compare_quantile_loss</span><span class="p">(</span><span class="n">Y_test</span><span class="p">,</span> <span class="n">method_imputations</span><span class="p">,</span> <span class="n">imputed_variables</span><span class="p">)</span>

<span class="c1"># Plot the comparison</span>
<span class="n">comparison_viz</span> <span class="o">=</span> <span class="n">method_comparison_results</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">loss_comparison_df</span><span class="p">,</span>
        <span class="n">metric_name</span><span class="o">=</span><span class="s2">&quot;Test Quantile Loss&quot;</span><span class="p">,</span>
        <span class="n">data_format</span><span class="o">=</span><span class="s2">&quot;long&quot;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">comparison_viz</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">show_mean</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="best-practices-for-implementing-new-models">
<h2>Best practices for implementing new models<a class="headerlink" href="#best-practices-for-implementing-new-models" title="Permalink to this heading">#</a></h2>
<p>When implementing a new imputation model for MicroImpute, adhering to certain best practices will ensure your model integrates seamlessly with the framework and provides a consistent experience for users.</p>
<section id="architecture">
<h3>Architecture<a class="headerlink" href="#architecture" title="Permalink to this heading">#</a></h3>
<p>The two-class architecture forms the foundation of a well-designed imputation model. You should create an <code class="docutils literal notranslate"><span class="pre">Imputer</span></code> subclass that handles model definition and fitting operations, establishing the core functionality of your approach. This class should be complemented by an <code class="docutils literal notranslate"><span class="pre">ImputerResults</span></code> subclass that represents the fitted model state and handles all prediction-related tasks. This separation of concerns creates a clean distinction between the fitting and prediction phases of your model’s lifecycle.</p>
<p>Within these classes, you must implement the required abstract methods to fulfill the contract with the base classes. Your <code class="docutils literal notranslate"><span class="pre">Imputer</span></code> subclass should provide a thorough implementation of the <code class="docutils literal notranslate"><span class="pre">_fit()</span></code> method that handles the training process for your specific algorithm. Similarly, your <code class="docutils literal notranslate"><span class="pre">ImputerResults</span></code> subclass needs to implement the <code class="docutils literal notranslate"><span class="pre">_predict()</span></code> method that applies the fitted model to new data and generates predictions at requested quantiles. Check how currently supported models have been implemented if you would like to ensure iterative imputation for multiple target variables fully compatible with how other models do it. For example, to be able to compute quantile loss accross imputed quantiles and variables and compare it with different methods you must ensure iterative imputation within the fitting and predicting methods.</p>
</section>
<section id="error-handling">
<h3>Error handling<a class="headerlink" href="#error-handling" title="Permalink to this heading">#</a></h3>
<p>Robust error handling is crucial for creating reliable imputation models. Your implementation should wrap model fitting and prediction operations in appropriate try/except blocks to capture and handle potential errors gracefully. When exceptions occur, provide informative error messages that help users understand what went wrong and how to address the issue. Use appropriate error types such as ValueError for input validation failures and RuntimeError for operational failures during model execution.</p>
<p>Effective logging complements good error handling by providing visibility into the model’s operation. Use the self.logger instance consistently throughout your code to record important information about the model’s state and progress. Log significant events like the start and completion of fitting operations, parameter values, and any potential issues or warnings that arise during execution.</p>
</section>
<section id="parameters-and-validation">
<h3>Parameters and validation<a class="headerlink" href="#parameters-and-validation" title="Permalink to this heading">#</a></h3>
<p>Type safety and parameter validation enhance the usability and reliability of your model. Add comprehensive type hints to all methods and parameters to enable better IDE support and make your code more self-documenting. Apply the <code class="docutils literal notranslate"><span class="pre">validate_call</span></code> decorator with the standard VALIDATE_CONFIG configuration to method signatures to enforce parameter validation consistently.</p>
<p>Your implementation should thoughtfully support model-specific parameters that may be needed to control the behavior of your algorithm. Design your <code class="docutils literal notranslate"><span class="pre">_fit()</span></code> and <code class="docutils literal notranslate"><span class="pre">_predict()</span></code> methods to accept and properly utilize these parameters, ensuring they affect the model’s operation as intended. Document all parameters clearly in your docstrings, explaining their purpose, expected values, and default behavior to guide users in effectively configuring your model.</p>
</section>
<section id="documentation">
<h3>Documentation<a class="headerlink" href="#documentation" title="Permalink to this heading">#</a></h3>
<p>Comprehensive documentation makes your model accessible to others. Include detailed class-level docstrings that explain your model’s theoretical approach, strengths, limitations, and appropriate use cases. Document all methods with properly structured docstring sections covering arguments, return values, and potential exceptions. Where appropriate, provide usage examples that demonstrate how to initialize, train, and use your model for prediction tasks.</p>
<p>The documentation should be complemented by thorough unit tests that verify your implementation works correctly. Create tests that check both basic interface compliance (ensuring your model adheres to the expected API) and model-specific functionality (validating that your algorithm produces correct results). Comprehensive testing helps catch issues early and provides confidence that your implementation will work reliably in production environments.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./models/imputer"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../matching/index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Statistical Matching</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="index.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">The Imputer class</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Creating a new imputer model</a><ul>
<li><a class="reference internal" href="#understanding-the-microimpute-architecture">Understanding the microImpute architecture</a></li>
<li><a class="reference internal" href="#implementing-a-model-results-class">Implementing a model results class</a></li>
<li><a class="reference internal" href="#implementing-the-main-model-class">Implementing the main model class</a></li>
<li><a class="reference internal" href="#testing-the-new-model">Testing the new model</a></li>
<li><a class="reference internal" href="#integrating-with-the-benchmarking-framework">Integrating with the benchmarking framework</a></li>
<li><a class="reference internal" href="#best-practices-for-implementing-new-models">Best practices for implementing new models</a><ul>
<li><a class="reference internal" href="#architecture">Architecture</a></li>
<li><a class="reference internal" href="#error-handling">Error handling</a></li>
<li><a class="reference internal" href="#parameters-and-validation">Parameters and validation</a></li>
<li><a class="reference internal" href="#documentation">Documentation</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script src="../../_static/scripts/furo.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    </body>
</html>